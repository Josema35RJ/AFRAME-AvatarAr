<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Avatar AR Simple y Seguro</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    body { margin:0; overflow:hidden; }
    #modal {
      display:none;
      position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.85); color:white;
      font-family:Arial, sans-serif; text-align:center;
      padding-top:20%; z-index:9999;
    }
    #modal button {
      margin-top:20px; padding:10px 20px; font-size:16px;
    }
  </style>
</head>
<body>
  <!-- Modal de error -->
  <div id="modal">
    <h2 id="modal-msg">Error</h2>
    <button onclick="location.reload()">Reintentar</button>
  </div>

  <!-- Escena AR -->
  <a-scene vr-mode-ui="enabled: false" embedded>
    <a-assets>
      <video id="cam" autoplay playsinline muted></video>
      <a-asset-item id="avatar" src="https://cdn.jsdelivr.net/gh/Josema35RJ/Avatar/3dpea.com_Salute.glb"></a-asset-item>
    </a-assets>

    <!-- Fondo con cámara -->
    <a-plane id="camBackground"
             position="0 1.6 -5"
             rotation="0 0 0"
             width="16"
             height="9"
             material="shader: flat; src: #cam;">
    </a-plane>

    <!-- Avatar centrado enfrente -->
    <a-entity gltf-model="#avatar"
              scale="0.6 0.6 0.6"
              position="0 -1.5 -3"
              rotation="0 180 0">
    </a-entity>

    <a-entity camera look-controls></a-entity>
  </a-scene>

  <script>
    const video = document.getElementById('cam');
    const modal = document.getElementById('modal');
    const modalMsg = document.getElementById('modal-msg');

    function showError(msg) {
      modalMsg.innerText = msg;
      modal.style.display = "block";
    }

    // Comprobar soporte de cámara
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
      showError("Tu navegador no soporta acceso a la cámara. Prueba en Chrome, Edge o Safari.");
    } else {
      navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" }, audio: false })
        .then(stream => {
          video.srcObject = stream;
        })
        .catch(err => {
          showError("No se pudo acceder a la cámara. Revisa permisos o configuración.");
          console.error(err);
        });
    }
  </script>
</body>
</html>
