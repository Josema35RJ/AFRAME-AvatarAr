<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>Avatar AR Profesional</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>
      #ui {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 999;
      }
      button {
        padding: 10px 20px;
        font-size: 16px;
        margin: 5px;
        border-radius: 8px;
        border: none;
        background: #0078ff;
        color: white;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <!-- Escena AR -->
    <a-scene
      vr-mode-ui="enabled: false"
      renderer="colorManagement: true, physicallyCorrectLights: true"
      embedded
      xrweb="optionalFeatures: hit-test, dom-overlay; overlayElement: #ui">

      <!-- Reticle para colocar avatar -->
      <a-entity id="reticle"
                geometry="primitive: ring; radiusInner: 0.05; radiusOuter: 0.07"
                material="color: #00ff00; shader: flat; opacity: 0.7"
                rotation="-90 0 0"
                visible="false">
      </a-entity>

      <!-- Avatar -->
      <a-entity id="avatar"
        gltf-model="https://cdn.jsdelivr.net/gh/Josema35RJ/Avatar@main/3dpea.com_Salute.glb"
        scale="0.5 0.5 0.5"
        visible="false">
      </a-entity>

      <!-- Luz -->
      <a-entity light="type: ambient; intensity: 1"></a-entity>
      <a-entity light="type: directional; intensity: 0.8" position="1 3 2"></a-entity>
    </a-scene>

    <!-- UI -->
    <div id="ui">
      <button onclick="placeAvatar()">üìç Colocar Avatar</button>
      <button onclick="resetAvatar()">üîÑ Reset</button>
    </div>

    <script>
      const avatar = document.getElementById("avatar");
      const reticle = document.getElementById("reticle");

      // Colocar avatar en posici√≥n del reticle
      function placeAvatar() {
        if (reticle.object3D.visible) {
          avatar.setAttribute("visible", "true");
          avatar.object3D.position.copy(reticle.object3D.position);

          // Que mire hacia la c√°mara
          const camera = document.querySelector("[camera]").object3D;
          avatar.object3D.lookAt(camera.position);
        }
      }

      // Resetear avatar
      function resetAvatar() {
        avatar.setAttribute("visible", "false");
      }

      // Fallback si no hay WebXR (simular AR con webcam)
      if (!navigator.xr) {
        console.warn("‚ö†Ô∏è WebXR no soportado, usando fallback");
        document.querySelector("a-scene").setAttribute("arjs", "sourceType: webcam; debugUIEnabled: false;");

        // Posici√≥n fija del avatar en modo simulado
        avatar.setAttribute("visible", "true");
        avatar.setAttribute("position", "0 0 -2");
        avatar.setAttribute("rotation", "0 180 0");
      }
    </script>
  </body>
</html>
